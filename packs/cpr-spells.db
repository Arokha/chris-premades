{"name":"Call Lightning","type":"spell","img":"icons/magic/lightning/bolt-forked-large-blue-yellow.webp","system":{"description":{"value":"<p>You must have a token on the scene to use this spell (Warpgate mutation limitation). After casting this spell a new feature called \"Storm Bolt\" will be available on your features. If you use \"Tidy 5e Sheet\" it will automatically be favorited. If you use \"Custom Character Sheet Sections\" it will be in it's own section called \"Spell Features.\"</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 220","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"10","units":"minute"},"cover":null,"target":{"value":60,"width":null,"units":"ft","type":"cylinder"},"range":{"value":120,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"[1d10 - lightning] Cast outdoors in stormy conditions","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"con","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[],"flags":{"ddbimporter":{"id":136172,"definitionId":2022,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":220,"sourceType":1}],"tags":["Damage"],"version":"3.2.3","originalName":"Call Lightning","effectsApplied":true},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":"[postActiveEffects]ItemMacro","effectActivation":false},"itemacro":{"macro":{"_data":{"name":"Call Lightning","type":"script","scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" \nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\n\nconst DAEitem = lastArg.efData.flags.dae.itemData\nconst saveData = DAEitem.data.save\n/**\n * Create Call Lightning Bolt item in inventory\n */\nif (args[0] === \"on\") {\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 60,\n        direction: 0,\n        x: 0,\n        y: 0,\n        flags: {\n            DAESRD: {\n                CallLighting: {\n                    ActorId: tactor.id\n                }\n            }\n        },\n        fillColor: game.user.color\n    }\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData)\n    template.actorSheet = tactor.sheet;\n    template.drawPreview()\n    await tactor.createOwnedItem(\n        {\n            \"name\": \"Call Lightning - bolt\",\n            \"type\": \"spell\",\n            \"data\": {\n              \"description\": {\n                \"value\": \"<p><span style=\\\"color: #191813; font-size: 13px;\\\">A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one.</span></p>\"\n              },\n              \"activation\": {\n                \"type\": \"action\"\n              },\n              \"target\": {\n                \"value\": 5,\n                \"width\": null,\n                \"units\": \"ft\",\n                \"type\": \"radius\"\n              },\n              \"ability\": \"\",\n              \"actionType\": \"save\",\n              \"damage\": {\n                \"parts\": [\n                  [\n                    `${DAEitem.data.level}d10`,\n                    \"lightning\"\n                  ]\n                ],\n                \"versatile\": \"\"\n              },\n              \"formula\": \"\",\n              \"save\": {\n                \"ability\": \"dex\",\n                \"dc\": 16,\n                \"scaling\": \"spell\"\n              },\n              \"level\": 0,\n              \"school\": \"abj\",\n              \"preparation\": {\n                \"mode\": \"prepared\",\n                \"prepared\": false\n              },\n              \"scaling\": {\n                \"mode\": \"none\",\n                \"formula\": \"\"\n              }\n            },\n            \"img\": \"systems/dnd5e/icons/spells/lighting-sky-2.jpg\"\n          }\n    );\n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n    let castItem = tactor.data.items.find(i => i.name === \"Call Lightning - bolt\" && i.type === \"spell\")\n    if(castItem) await tactor.deleteOwnedItem(castItem._id)\n    let template = canvas.templates.placeables.filter(i => i.data.flags.DAESRD?.CallLighting?.ActorId === tactor.id)\n    if(template) await canvas.templates.deleteMany(template[0].id)\n\n}","author":"E4BVikjIkVl2lL2j"},"data":{"name":"Call Lightning","type":"script","scope":"global","command":"const lastArg = args[args.length - 1];\nconst tokenOrActor = await fromUuid(lastArg.actorUuid);\nconst targetActor = tokenOrActor.actor ? tokenOrActor.actor : tokenOrActor;\nconst DAEItem = lastArg.efData.flags.dae.itemData;\nconst saveData = DAEItem.system.save;\nconst castItemName = \"Call Lightning - bolt\";\nconst castItem = targetActor.items.find((i) => i.name === castItemName && i.type === \"spell\");\n\n/**\n * Create Call Lightning Bolt item in inventory\n */\nif (args[0] === \"on\") {\n  const templateData = {\n    t: \"circle\",\n    user: game.userId,\n    distance: 60,\n    direction: 0,\n    x: 0,\n    y: 0,\n    flags: {\n      spellEffects: {\n        CallLighting: {\n          ActorId: targetActor.id,\n        },\n      },\n    },\n    fillColor: game.user.color,\n  };\n  let doc = new CONFIG.MeasuredTemplate.documentClass(templateData, {\n    parent: canvas.scene,\n  });\n  let template = new game.dnd5e.canvas.AbilityTemplate(doc);\n  template.actorSheet = targetActor.sheet;\n  template.drawPreview();\n\n  if (!castItem) {\n    const spell = {\n      name: castItemName,\n      type: \"spell\",\n      data: {\n        description: DAEItem.system.description,\n        activation: { type: \"action\", },\n        target: { value: 5, width: null, units: \"ft\", type: \"radius\", },\n        ability: DAEItem.system.ability,\n        attackBonus: DAEItem.system.attackBonus,\n        actionType: \"save\",\n        damage: { parts: [[`${args[1]}d10`, \"lightning\"]], versatile: \"\", },\n        formula: \"\",\n        save: { ability: \"dex\", dc: null, scaling: \"spell\" },\n        level: 0,\n        school: DAEItem.system.school,\n        preparation: { mode: \"prepared\", prepared: false, },\n        scaling: { mode: \"none\", formula: \"\", },\n      },\n      img: DAEItem.img,\n      effects: [],\n    };\n    await targetActor.createEmbeddedDocuments(\"Item\", [spell]);\n    ui.notifications.notify(\"Spell Bolt attack created in your spellbook\");\n  }\n}\n\n// Delete Lighting bolt\nif (args[0] === \"off\") {\n  if (castItem) await targetActor.deleteEmbeddedDocuments(\"Item\", castItem._id);\n  const template = canvas.templates.placeables.find((i) => i.flags.spellEffects?.CallLighting?.ActorId === targetActor.id);\n  if (template) await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [template.id]);\n}\n","author":"zrPR3wueYsESSBR3","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"options":{},"apps":{},"compendium":null,"name":"Call Lightning","type":"script","scope":"global","command":"await chrisPremades.macros.callLightning(this);","author":"PQGBBcoVSwpUhViM","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"cf":{"id":"temp_mxbijym230p"},"custom-character-sheet-sections":{"sectionName":""},"rest-recovery":{"data":{"recovery":{"enabled":false}}},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false,"autoSaveFriendly":false},"core":{"sourceId":"Compendium.world.ddb-homebrew-spells.ewc7qZF2iwwqyk1f"},"enhanced-terrain-layer":{"multiple":null,"elevation":null,"depth":null,"environment":""},"autoanimations":{"id":"c7aa4351-def0-44fe-81cd-f80cc6e5316b","label":"Call Lightning","macro":{"enable":false,"playWhen":"0"},"menu":"templatefx","primary":{"video":{"dbSection":"templatefx","menuType":"circle","animation":"calllightning","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"delay":0,"elevation":1000,"isMasked":false,"isWait":false,"occlusionAlpha":0.5,"occlusionMode":"0","opacity":0.5,"persistent":true,"persistType":"sequencerground","playbackRate":1,"removeTemplate":true,"repeat":1,"repeatDelay":250,"rotate":0,"scale":"1","zIndex":1,"aboveTemplate":true}},"secondary":{"enable":false,"video":{"dbSection":"static","menuType":"spell","animation":"curewounds","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"addTokenWidth":false,"anchor":"0.5","delay":0,"elevation":1000,"fadeIn":250,"fadeOut":500,"isMasked":false,"isRadius":true,"isWait":false,"opacity":1,"repeat":1,"repeatDelay":250,"size":1.5,"zIndex":1}},"soundOnly":{"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75}},"source":{"enable":false,"video":{"dbSection":"static","menuType":"spell","animation":"curewounds","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"addTokenWidth":false,"anchor":"0.5","delay":0,"elevation":1000,"fadeIn":250,"fadeOut":500,"isMasked":false,"isRadius":false,"isWait":true,"opacity":1,"repeat":1,"repeatDelay":250,"size":1,"zIndex":1}},"target":{"enable":false,"video":{"dbSection":"static","menuType":"spell","animation":"curewounds","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"addTokenWidth":false,"anchor":"0.5","delay":0,"elevation":1000,"fadeIn":250,"fadeOut":500,"isMasked":false,"isRadius":false,"opacity":1,"persistent":false,"repeat":1,"repeatDelay":250,"size":1,"unbindAlpha":false,"unbindVisibility":false,"zIndex":1}},"isEnabled":true,"isCustomized":true,"fromAmmo":false,"version":5},"exportSource":{"world":"homebrew","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.4"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1669191924534,"modifiedTime":1676839149230,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"WqiZiJxFY8AacZxO"}
{"type":"spell","system":{"description":{"value":"<p>Enable \"Armor of Agathys Automation\" in the module settings for this to be automated.</p>","chat":"","unidentified":""},"source":"Player's Handbook pg 215","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"1","units":"hour"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"util","attackBonus":"","chatFlavor":"[cold] A creature takes the cold damage when it hits you with a melee attack while you have the temporary hit points.","critical":{"threshold":null,"damage":""},"damage":{"parts":[["5","temphp"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"abj","components":{"vocal":true,"somatic":true,"material":true,"ritual":false,"concentration":false},"materials":{"value":"a cup of water","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"level","formula":"(@item.level - 1) * 5"}},"name":"Armor of Agathys","flags":{"ddbimporter":{"id":136066,"definitionId":2310,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"originalName":"Armor of Agathys","sources":[{"sourceId":2,"pageNumber":215,"sourceType":1}],"tags":["Damage","Buff","Warding"],"version":"3.3.10","effectsApplied":true},"itemacro":{"macro":{"data":{"name":"Armor of Agathys","type":"script","scope":"global","command":"if (args.length !== 3 || args[0] !== \"onUpdateActor\") return;\nconst lastArg = args[2];\nconst spellLevel = args[1];\nconst message = game.messages.contents.findLast((i) =>\n  i.content.includes('<div class=\"dnd5e chat-card item-card midi-qol-item-card\"')\n);\nlet workflow = MidiQOL.Workflow.getWorkflow(message.flags[\"midi-qol\"].workflowId);\nconst validAttacks = [\"mwak\", \"msak\"];\nif (\n  validAttacks.includes(workflow.item?.system?.actionType) &&\n  workflow.hitTargets?.has(lastArg.sourceToken)\n) {\n  const attackerToken = workflow.token;\n  const damageAmount = parseInt(spellLevel) * 5;\n  const damageType = \"cold\";\n  const messageContent = `Armor of Agathys reactive damage: ${damageAmount} (${damageType})`;\n  await ChatMessage.create({ content: messageContent });\n  console.log(attackerToken);\n  await MidiQOL.applyTokenDamage(\n    [{ type: `${damageType}`, damage: damageAmount }],\n    damageAmount,\n    new Set([attackerToken]),\n    item,\n    new Set(),\n    { forceApply: false }\n  );\n}\nif (lastArg.updates.system.attributes.hp.temp <= 0) {\n  const effectId = lastArg.sourceActor.effects.find((eff) => eff.label === \"Armor of Agathys\").id;\n  await MidiQOL.socket().executeAsGM(\"removeEffects\", { actorUuid: lastArg.actorUuid, effects: [effectId] });\n}\n"},"options":{},"apps":{},"compendium":null,"name":"Armor of Agathys","type":"script","scope":"global","command":"","author":"PQGBBcoVSwpUhViM","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"midi-qol":{"forceCEOff":true,"effectActivation":false},"cf":{"id":"temp_2drgo1op6wj"},"custom-character-sheet-sections":{"sectionName":""},"rest-recovery":{"data":{"recovery":{"enabled":false}}},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Compendium.world.ddb-development-testing-ddb-spells.bI3rhYnzetRoTTml"}},"effects":[{"label":"Armor of Agathys","icon":"icons/magic/defensive/shield-barrier-flaming-diamond-blue.webp","changes":[],"duration":{"seconds":null,"startTime":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"tint":null,"transfer":false,"disabled":false,"flags":{"dae":{"transfer":false,"stackable":"none","selfTarget":true,"selfTargetAlways":true,"durationExpression":"","macroRepeat":"none","specialDuration":[]},"ddbimporter":{"disabled":false},"midi-qol":{"forceCEOff":true},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}},"_id":"YV2c7BFxcYqGy2w2","origin":null}],"img":"icons/magic/defensive/shield-barrier-flaming-diamond-blue.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1676798650591,"modifiedTime":1676835626724,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"aEGgnyfIptlTDm5l"}
{"$$deleted":true,"_id":"WqiZiJxFY8AacZxO"}
{"name":"Call Lightning","type":"spell","img":"icons/magic/lightning/bolt-forked-large-blue-yellow.webp","system":{"description":{"value":"<p>You must have a token on the scene to use this spell (Warpgate mutation limitation). After casting this spell a new feature called \"Storm Bolt\" will be available on your features. If you use \"Tidy 5e Sheet\" it will automatically be favorited. If you use \"Custom Character Sheet Sections\" it will be in it's own section called \"Spell Features.\"</p>","chat":"","unidentified":""},"source":"Basic Rules, Player's Handbook pg 220","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"10","units":"minute"},"cover":null,"target":{"value":60,"width":null,"units":"ft","type":"cylinder"},"range":{"value":120,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"[1d10 - lightning] Cast outdoors in stormy conditions","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"con","components":{"vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[],"flags":{"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":"[postActiveEffects]ItemMacro","effectActivation":false},"itemacro":{"macro":{"options":{},"apps":{},"compendium":null,"name":"Call Lightning","type":"script","scope":"global","command":"await chrisPremades.macros.callLightning(this);","author":"PQGBBcoVSwpUhViM","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"custom-character-sheet-sections":{"sectionName":""},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false,"autoSaveFriendly":false},"core":{"sourceId":"Compendium.world.ddb-homebrew-spells.ewc7qZF2iwwqyk1f"},"autoanimations":{"id":"c7aa4351-def0-44fe-81cd-f80cc6e5316b","label":"Call Lightning","macro":{"enable":false,"playWhen":"0"},"menu":"templatefx","primary":{"video":{"dbSection":"templatefx","menuType":"circle","animation":"calllightning","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"delay":0,"elevation":1000,"isMasked":false,"isWait":false,"occlusionAlpha":0.5,"occlusionMode":"0","opacity":0.5,"persistent":true,"persistType":"sequencerground","playbackRate":1,"removeTemplate":true,"repeat":1,"repeatDelay":250,"rotate":0,"scale":"1","zIndex":1,"aboveTemplate":true}},"secondary":{"enable":false,"video":{"dbSection":"static","menuType":"spell","animation":"curewounds","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"addTokenWidth":false,"anchor":"0.5","delay":0,"elevation":1000,"fadeIn":250,"fadeOut":500,"isMasked":false,"isRadius":true,"isWait":false,"opacity":1,"repeat":1,"repeatDelay":250,"size":1.5,"zIndex":1}},"soundOnly":{"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75}},"source":{"enable":false,"video":{"dbSection":"static","menuType":"spell","animation":"curewounds","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"addTokenWidth":false,"anchor":"0.5","delay":0,"elevation":1000,"fadeIn":250,"fadeOut":500,"isMasked":false,"isRadius":false,"isWait":true,"opacity":1,"repeat":1,"repeatDelay":250,"size":1,"zIndex":1}},"target":{"enable":false,"video":{"dbSection":"static","menuType":"spell","animation":"curewounds","variant":"01","color":"blue","enableCustom":false,"customPath":""},"sound":{"enable":false,"delay":0,"repeat":1,"repeatDelay":250,"startTime":0,"volume":0.75},"options":{"addTokenWidth":false,"anchor":"0.5","delay":0,"elevation":1000,"fadeIn":250,"fadeOut":500,"isMasked":false,"isRadius":false,"opacity":1,"persistent":false,"repeat":1,"repeatDelay":250,"size":1,"unbindAlpha":false,"unbindVisibility":false,"zIndex":1}},"isEnabled":true,"isCustomized":true,"fromAmmo":false,"version":5},"exportSource":{"world":"development-testing","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.4"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.4","coreVersion":"10.291","createdTime":1669191924534,"modifiedTime":1676839989020,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"zv30JG81vt3Kwe5e"}
