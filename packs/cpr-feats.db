{"name":"Elemental Adept (Thunder)","type":"feat","system":{"description":{"value":"<p><span style=\"font-family:Signika, sans-serif\">Enable \"Elemental Adept Automation\" in the module settings for this to work.</span></p><p>This feature will automatically count 1s as 2s for spell damage.</p><p>This feature will automatically ignore target damage resistance.</p><p><em>This feature is safe to rename.</em></p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"","cost":null,"condition":""},"duration":{"value":"","units":""},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":null,"amount":null},"ability":null,"actionType":"","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":53,"type":"feat","entityTypeId":1088085227,"dndbeyond":{},"importId":"QeXFJczsnLVKlMMZ"},"obsidian":{"source":{"type":"feat"}},"custom-character-sheet-sections":{"sectionName":""},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.9o1F1iT29nfWN3FH"}},"effects":[{"label":"Elemental Adept (Thunder","icon":"icons/magic/fire/projectile-fireball-purple.webp","changes":[{"key":"flags.chris-premades.feat.elementalAdept.acid","mode":5,"value":"1","priority":20}],"transfer":true,"_id":"cCbNbMsy9dHwiQ5W","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"img":"icons/magic/fire/projectile-fireball-purple.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680064841224,"modifiedTime":1680072606569,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"7iRsMZXe9cLysBYt"}
{"name":"Elemental Adept (Acid)","type":"feat","system":{"description":{"value":"<p><span style=\"font-family:Signika, sans-serif\">Enable \"Elemental Adept Automation\" in the module settings for this to work.</span></p><p>This feature will automatically count 1s as 2s for spell damage.</p><p>This feature will automatically ignore target damage resistance.</p><p><em>This feature is safe to rename.</em></p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"","cost":null,"condition":""},"duration":{"value":"","units":""},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":null,"amount":null},"ability":null,"actionType":"","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":53,"type":"feat","entityTypeId":1088085227,"dndbeyond":{},"importId":"QeXFJczsnLVKlMMZ"},"obsidian":{"source":{"type":"feat"}},"custom-character-sheet-sections":{"sectionName":""},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.9o1F1iT29nfWN3FH"}},"effects":[{"label":"Elemental Adept (Acid)","icon":"icons/magic/acid/projectile-faceted-glob.webp","changes":[{"key":"flags.chris-premades.feat.elementalAdept.acid","mode":5,"value":"1","priority":20}],"transfer":true,"_id":"cCbNbMsy9dHwiQ5W","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"img":"icons/magic/acid/projectile-faceted-glob.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680064841224,"modifiedTime":1680072605551,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"9XQf3TBWGsPXs6aP"}
{"name":"Elemental Adept (Fire)","type":"feat","system":{"description":{"value":"<p><span style=\"font-family:Signika, sans-serif\">Enable \"Elemental Adept Automation\" in the module settings for this to work.</span></p><p>This feature will automatically count 1s as 2s for spell damage.</p><p>This feature will automatically ignore target damage resistance.</p><p><em>This feature is safe to rename.</em></p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"","cost":null,"condition":""},"duration":{"value":"","units":""},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":null,"amount":null},"ability":null,"actionType":"","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":53,"type":"feat","entityTypeId":1088085227,"dndbeyond":{},"importId":"QeXFJczsnLVKlMMZ"},"obsidian":{"source":{"type":"feat"}},"custom-character-sheet-sections":{"sectionName":""},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.9o1F1iT29nfWN3FH"}},"effects":[{"label":"Elemental Adept (Fire)","icon":"icons/magic/fire/projectile-embers-orange.webp","changes":[{"key":"flags.chris-premades.feat.elementalAdept.fire","mode":5,"value":"1","priority":20}],"transfer":true,"_id":"cCbNbMsy9dHwiQ5W","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"img":"icons/magic/fire/projectile-embers-orange.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680064841224,"modifiedTime":1680072612603,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"C5UuUmjIixfDz8I4"}
{"name":"Elemental Adept (Cold)","type":"feat","system":{"description":{"value":"<p><span style=\"font-family:Signika, sans-serif\">Enable \"Elemental Adept Automation\" in the module settings for this to work.</span></p><p>This feature will automatically count 1s as 2s for spell damage.</p><p>This feature will automatically ignore target damage resistance.</p><p><em>This feature is safe to rename.</em></p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"","cost":null,"condition":""},"duration":{"value":"","units":""},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":null,"amount":null},"ability":null,"actionType":"","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":53,"type":"feat","entityTypeId":1088085227,"dndbeyond":{},"importId":"QeXFJczsnLVKlMMZ"},"obsidian":{"source":{"type":"feat"}},"custom-character-sheet-sections":{"sectionName":""},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.9o1F1iT29nfWN3FH"}},"effects":[{"label":"Elemental Adept (Cold)","icon":"icons/magic/water/projectile-ice-chunk-blue.webp","changes":[{"key":"flags.chris-premades.feat.elementalAdept.cold","mode":5,"value":"1","priority":20}],"transfer":true,"_id":"cCbNbMsy9dHwiQ5W","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"img":"icons/magic/water/projectile-ice-chunk-blue.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680064841224,"modifiedTime":1680072611234,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"KLf6AB4ZH2xXTtqT"}
{"name":"Piercer: Reroll Damage","type":"feat","system":{"description":{"value":"<p>This feature will automatically prompt you to reroll the lowest damage dice.</p><p>You can set the second flag in the effect to a number to have it automatically use this feature when the dice is the set number or lower.</p><p><em>This feature is safe to rename. Do not rename the effect.</em></p>","chat":"","unidentified":""},"source":"","activation":{"type":"special","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":"2401089","entityTypeId":"222216831","componentId":452845,"componentTypeId":1088085227,"type":"feat","effectsApplied":true,"importId":"KY2Rf5Uv7kmw6QCV"},"infusions":{"infused":false},"obsidian":{"source":{"type":"feat"}},"itemacro":{"macro":{"data":{"name":"Piercer: Reroll Damage","type":"script","scope":"global","command":"if (![\"mwak\", \"rwak\", \"msak\", \"rsak\"].includes(args[0].item.system.actionType)) return;\nif (args[0].hitTargets.length < 1 || args[0].item.system.damage.parts[0][1] !== \"piercing\") return {};\n\nconsole.warn(args[0]);\nconst roll = args[0].damageRoll;\nif (!roll.terms[0].faces) return;\n\nconst dieSize = roll.terms[0].faces;\n\nif (args[0].tag === \"DamageBonus\" && args[0].isCritical) {\n  return { damageRoll: `1d${dieSize}[piercing]`, flavor: \"Critical Piercer Feat extra damage\" };\n}\n\nconst lowDice = Math.min(...roll.terms[0].values);\n\nif (args[0].macroPass === \"postDamageRoll\" && lowDice !== dieSize) {\n  console.warn(args[0].uuid)\n  let workflow = MidiQOL.Workflow.getWorkflow(args[0].uuid);\n  let response = await Dialog.confirm({\n    title: \"Piercer feat\",\n    content: `<p>${args[0].actor.name} rolled a ${lowDice} on 1d${dieSize}. Reroll?</p>`,\n  });\n  if (!response) return;\n\n  const damageRoll = new Roll(`1d${dieSize}`);\n  await damageRoll.toMessage({ flavor: `Piercer rerolled ${lowDice}...` });\n  workflow.damageRoll.dice[0].results.find((i) => i.result === lowDice).result = damageRoll.total;\n\n  Hooks.once(\"midi-qol.DamageRollComplete\", async (workflow) => {\n    let totalDamage = 0;\n    let merged = workflow.damageDetail.reduce((acc, item) => {\n      acc[item.type] = (acc[item.type] ?? 0) + item.damage;\n      return acc;\n    }, {});\n\n    const newDetail = Object.keys(merged).map((key) => { return { damage: Math.max(0, merged[key]), type: key } });\n    totalDamage = newDetail.reduce((acc, value) => acc + value.damage, 0);\n    workflow.damageDetail = newDetail;\n    workflow.damageTotal = totalDamage;\n\n    workflow.damageRoll._total = workflow.damageTotal;\n    workflow.damageRollHTML = await workflow.damageRoll.render();\n\n    await workflow.displayDamageRoll()\n    // console.warn(\"workflow2\", duplicate({damageRoll: workflow.damageRoll, damageDetail:workflow.damageDetail, damageTotal: workflow.damageTotal}));\n    return true;\n  });\n\n}\n\n"},"options":{},"apps":{},"compendium":null,"name":"Piercer: Reroll Damage","type":"script","scope":"global","command":"","author":"PQGBBcoVSwpUhViM","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"midi-qol":{"forceCEOff":true,"effectActivation":false},"custom-character-sheet-sections":{"sectionName":""},"rest-recovery":{"data":{"recovery":{"enabled":false}}},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.98P4ICMMGAVgf2Ig"},"chris-premades":{"feat":{"piercer":{"turn":""}}}},"effects":[{"label":"Piercer: Reroll Damage","icon":"icons/weapons/polearms/spear-ornate-gold.webp","changes":[{"key":"flags.midi-qol.onUseMacroName","mode":0,"value":"function.await chrisPremades.macros.piercer.reroll,postDamageRoll","priority":20},{"key":"flags.chris-premades.feat.piercer.auto","mode":5,"value":"","priority":20}],"transfer":true,"_id":"R1t8Cu7FKxC3sDPX","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"effectmacro":{"onCombatEnd":{"script":"await chrisPremades.macros.piercer.combatEnd(origin);"}}}}],"img":"icons/weapons/polearms/spear-ornate-gold.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680420004610,"modifiedTime":1680458488135,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"bW4HBGVV3WYLXOF5"}
{"name":"Orcish Fury - Extra Damage","type":"feat","system":{"description":{"value":"<p>This feature should be used before making the attack.</p><p>This feature will automatically get refunded upon a miss.</p><p><em>This feature is safe to rename. Do not rename the effect.</em></p>","chat":"","unidentified":""},"source":"","activation":{"type":"special","cost":1,"condition":""},"duration":{"value":"1","units":"turn"},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":0,"max":"1","per":"sr","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":"53628","entityTypeId":"222216831","componentId":91,"componentTypeId":1088085227,"type":"feat","importId":"9JUjATw2P3PceSw7"},"infusions":{"infused":false},"obsidian":{"source":{"type":"feat"}},"link-item-resource-5e":{"resource-link":""},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.ONacF4tpd0I7PfoE"},"custom-character-sheet-sections":{"sectionName":""},"rest-recovery":{"data":{"recovery":{"enabled":false}}},"midi-qol":{"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false}},"effects":[{"label":"Orcish Fury - Extra Damage","icon":"icons/skills/toxins/cup-goblet-poisoned-spilled.webp","changes":[{"key":"flags.midi-qol.onUseMacroName","mode":0,"value":"function.await chrisPremades.macros.orcishFury,postDamageRoll","priority":20}],"transfer":false,"_id":"LIJdWV9x1qIasvkb","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":["1Attack"]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"img":"icons/skills/toxins/cup-goblet-poisoned-spilled.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680212252055,"modifiedTime":1680213721057,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"svxGjhxcDkqbqteK"}
{"name":"Elemental Adept (Lightning)","type":"feat","system":{"description":{"value":"<p><span style=\"font-family:Signika, sans-serif\">Enable \"Elemental Adept Automation\" in the module settings for this to work.</span></p><p>This feature will automatically count 1s as 2s for spell damage.</p><p>This feature will automatically ignore target damage resistance.</p><p><em>This feature is safe to rename.</em></p>","chat":"","unidentified":""},"source":"Player's Handbook","activation":{"type":"","cost":null,"condition":""},"duration":{"value":"","units":""},"cover":null,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":null,"amount":null},"ability":null,"actionType":"","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":53,"type":"feat","entityTypeId":1088085227,"dndbeyond":{},"importId":"QeXFJczsnLVKlMMZ"},"obsidian":{"source":{"type":"feat"}},"custom-character-sheet-sections":{"sectionName":""},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.9o1F1iT29nfWN3FH"}},"effects":[{"label":"Elemental Adept (Lightning)","icon":"icons/magic/lightning/bolt-strike-blue.webp","changes":[{"key":"flags.chris-premades.feat.elementalAdept.lightning","mode":5,"value":"1","priority":20}],"transfer":true,"_id":"cCbNbMsy9dHwiQ5W","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"img":"icons/magic/lightning/bolt-strike-blue.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680064841224,"modifiedTime":1680072607991,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"teAfo1mwUNwl8hx7"}
{"name":"Piercer: Critical Hit","type":"feat","system":{"description":{"value":"<p>This feature will automatically add the additional dice for critical hits.</p><p><em>This feature is safe to rename. Do not rename the effect.</em></p>","chat":"","unidentified":""},"source":"","activation":{"type":"special","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"target":{"value":null,"width":null,"units":"","type":"self"},"range":{"value":null,"long":null,"units":"self"},"uses":{"value":null,"max":"","per":"","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"type":{"value":"feat","subtype":""},"requirements":"","recharge":{"value":null,"charged":false}},"flags":{"ddbimporter":{"id":"2401097","entityTypeId":"222216831","componentId":452845,"componentTypeId":1088085227,"type":"feat","effectsApplied":true,"importId":"KY2Rf5Uv7kmw6QCV"},"infusions":{"infused":false},"obsidian":{"source":{"type":"feat"}},"itemacro":{"macro":{"data":{"name":"Piercer: Critical Hit","type":"script","scope":"global","command":"if (![\"mwak\", \"rwak\", \"msak\", \"rsak\"].includes(args[0].item.system.actionType)) return;\nif (args[0].hitTargets.length < 1 || args[0].item.system.damage.parts[0][1] !== \"piercing\") return {};\n\nconsole.warn(args[0]);\nconst roll = args[0].damageRoll;\nif (!roll.terms[0].faces) return;\n\nconst dieSize = roll.terms[0].faces;\n\nif (args[0].tag === \"DamageBonus\" && args[0].isCritical) {\n  return { damageRoll: `1d${dieSize}[piercing]`, flavor: \"Critical Piercer Feat extra damage\" };\n}\n\nconst lowDice = Math.min(...roll.terms[0].values);\n\nif (args[0].macroPass === \"postDamageRoll\" && lowDice !== dieSize) {\n  console.warn(args[0].uuid)\n  let workflow = MidiQOL.Workflow.getWorkflow(args[0].uuid);\n  let response = await Dialog.confirm({\n    title: \"Piercer feat\",\n    content: `<p>${args[0].actor.name} rolled a ${lowDice} on 1d${dieSize}. Reroll?</p>`,\n  });\n  if (!response) return;\n\n  const damageRoll = new Roll(`1d${dieSize}`);\n  await damageRoll.toMessage({ flavor: `Piercer rerolled ${lowDice}...` });\n  workflow.damageRoll.dice[0].results.find((i) => i.result === lowDice).result = damageRoll.total;\n\n  Hooks.once(\"midi-qol.DamageRollComplete\", async (workflow) => {\n    let totalDamage = 0;\n    let merged = workflow.damageDetail.reduce((acc, item) => {\n      acc[item.type] = (acc[item.type] ?? 0) + item.damage;\n      return acc;\n    }, {});\n\n    const newDetail = Object.keys(merged).map((key) => { return { damage: Math.max(0, merged[key]), type: key } });\n    totalDamage = newDetail.reduce((acc, value) => acc + value.damage, 0);\n    workflow.damageDetail = newDetail;\n    workflow.damageTotal = totalDamage;\n\n    workflow.damageRoll._total = workflow.damageTotal;\n    workflow.damageRollHTML = await workflow.damageRoll.render();\n\n    await workflow.displayDamageRoll()\n    // console.warn(\"workflow2\", duplicate({damageRoll: workflow.damageRoll, damageDetail:workflow.damageDetail, damageTotal: workflow.damageTotal}));\n    return true;\n  });\n\n}\n\n"},"options":{},"apps":{},"compendium":null,"name":"Piercer: Critical Hit","type":"script","scope":"global","command":"","author":"PQGBBcoVSwpUhViM","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"midi-qol":{"forceCEOff":true,"effectActivation":false},"core":{"sourceId":"Actor.iXZRAxrrFFxPX0g6.Item.25wQQDZbk1HNGmyl"},"custom-character-sheet-sections":{"sectionName":""},"rest-recovery":{"data":{"recovery":{"enabled":false}}},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false}},"effects":[{"label":"Piercer: Critical Hit","icon":"icons/weapons/polearms/spear-ornate-gold.webp","changes":[{"key":"flags.midi-qol.onUseMacroName","mode":0,"value":"function.await chrisPremades.macros.piercer.critical,postDamageRoll","priority":20}],"transfer":true,"_id":"CG3pzKBGMXxnQ6vH","disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"img":"icons/weapons/polearms/spear-ornate-gold.webp","_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1680420004610,"modifiedTime":1680458489357,"lastModifiedBy":"PQGBBcoVSwpUhViM"},"folder":null,"sort":0,"ownership":{"default":0,"PQGBBcoVSwpUhViM":3},"_id":"yvJnxh3Gp4YJWhaV"}
